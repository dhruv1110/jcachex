const fs = require('fs');
const path = require('path');

// Define the examples directory and output file
const examplesDir = path.join(__dirname, '../src/examples');
const outputFile = path.join(__dirname, '../src/utils/loadExamples.ts');

// Function to read all files in a directory
function readExampleFiles(dir, fileExtension) {
    const files = {};
    const fullPath = path.join(examplesDir, dir);

    if (fs.existsSync(fullPath)) {
        const fileList = fs.readdirSync(fullPath).filter(file => file.endsWith(fileExtension));

        fileList.forEach(file => {
            const filePath = path.join(fullPath, file);
            const content = fs.readFileSync(filePath, 'utf8');
            // Convert filename to constant name (e.g. AsyncCacheExample -> ASYNC_CACHE_EXAMPLE)
            const baseName = file.replace(fileExtension, '');
            const constantName = baseName.replace(/([A-Z])/g, '_$1').replace(/^_/, '').toUpperCase();
            files[constantName] = content;
        });
    }

    return files;
}

// Read all example files
const javaFiles = readExampleFiles('java', '.java');
const kotlinFiles = readExampleFiles('kotlin', '.kt');
const springFiles = readExampleFiles('spring', '.java');

// Generate the constants file
let output = `// This file is auto-generated by scripts/generateExamples.js
// Do not edit manually - edit the individual files in src/examples/ instead

`;

// Add Java examples
Object.entries(javaFiles).forEach(([name, content]) => {
    // Escape backticks and dollar signs to prevent template literal issues
    const escapedContent = content.replace(/`/g, '\\`').replace(/\$/g, '\\$');
    output += `export const ${name}_EXAMPLE = \`${escapedContent}\`;

`;
});

// Add Kotlin examples
Object.entries(kotlinFiles).forEach(([name, content]) => {
    // Escape backticks and dollar signs to prevent template literal issues
    const escapedContent = content.replace(/`/g, '\\`').replace(/\$/g, '\\$');
    output += `export const ${name}_EXAMPLE = \`${escapedContent}\`;

`;
});

// Add Spring examples
Object.entries(springFiles).forEach(([name, content]) => {
    // Escape backticks and dollar signs to prevent template literal issues
    const escapedContent = content.replace(/`/g, '\\`').replace(/\$/g, '\\$');
    output += `export const ${name}_EXAMPLE = \`${escapedContent}\`;

`;
});

// Write the output file
fs.writeFileSync(outputFile, output);
console.log(`âœ… Generated constants file with ${Object.keys(javaFiles).length + Object.keys(kotlinFiles).length + Object.keys(springFiles).length} examples`);
console.log(`ğŸ“ Output: ${outputFile}`);
